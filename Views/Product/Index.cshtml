@model IEnumerable<QLBH.Models.Product>

@{
    ViewData["Title"] = "Index";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mb-0">Danh sách sản phẩm</h1>
    <div>
        <a class="btn btn-primary" asp-action="Create">Thêm sản phẩm</a>
        <form method="post" asp-action="LoadAll" style="display: inline;">
            <button type="submit" class="btn btn-primary">Nạp sản phẩm</button>
        </form>
        <form method="post" asp-action="DeleteAll" style="display: inline;">
            <button type="submit" class="btn btn-danger"
                onclick="return confirm('Bạn có chắc chắn muốn xóa tất cả sản phẩm?');">Xóa tất cả</button>
        </form>
    </div>
</div>

<hr />
<form method="get" asp-action="Index">
    <div class="form-group">
        <label class="form-label">Chọn danh mục:</label>
        <select class="form-control" name="categoryId" asp-items="ViewBag.CategoryId" onchange="this.form.submit()"
            required>
            <option value="">Tất cả</option>
        </select>
    </div>
</form>

<div class="row">
    @foreach (var item in Model)
    {
        <div class="col-md-4 w-25">
            <div class="card my-4 product-card w-100">
                <a class="card-header text-info" asp-action="Details" asp-route-id="@item.Id">@item.Name</a>
                <div class="card-body">
                    @if (!string.IsNullOrEmpty(item.Images))
                    {
                        var imageList = Newtonsoft.Json.JsonConvert.DeserializeObject<List<string>>(item.Images);
                        if (imageList != null && imageList.Any())
                        {
                            <a asp-action="Details" asp-route-id="@item.Id">
                                <img src="@imageList.First()" class="card-img-top product-image" alt="Ảnh sản phẩm">
                            </a>
                        }
                    }
                    else
                    {
                        <p class="text-muted">Không có ảnh</p>
                    }

                    <p class="card-text">@item.Description</p>
                    <p class="card-text">@item.Price</p>
                    <a href="#" class="btn btn-primary">Đặt hàng</a>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .card-header {
        font-size: 1.8rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block;
        max-width: 100%;
    }

    .product-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 8px;
    }

    a {
        font-size: 1.8rem;
    }
</style>